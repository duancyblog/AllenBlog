---
import essayData from "../assets/essay.json";
---

<div class="essay-carousel-container w-full py-4">
  <div class="max-w-[var(--page-width)] mx-auto px-4">
    <div class="essay-carousel relative overflow-hidden card-base card-shadow card-glass cursor-pointer" onclick="window.location.href='/essay/'">
      <div class="carousel-track flex transition-transform duration-500 ease-in-out" id="carousel-track">
        {essayData.map((item, index) => (
          <div 
            key={item.id} 
            class="carousel-item flex-shrink-0 w-full px-6 py-4"
          >
            <div class="carousel-content flex items-center justify-center h-full">
              <p class="text-content text-center">{item.content}</p>
            </div>
          </div>
        ))}
      </div>
      
      <!-- 轮播指示器 -->
      <div class="carousel-indicators absolute bottom-2 left-1/2 transform -translate-x-1/2 flex gap-1">
        {essayData.map((_, index) => (
          <button 
            key={index} 
            class={`indicator w-1.5 h-1.5 rounded-full transition-all ${index === 0 ? 'bg-primary w-4' : 'bg-muted'}`}
            data-index={index}
            onclick="event.stopPropagation();"
          ></button>
        ))}
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const track = document.getElementById('carousel-track');
  const items = document.querySelectorAll('.carousel-item');
  const indicators = document.querySelectorAll('.indicator');
  
  if (!track || !items.length) return;
  
  let currentIndex = 0;
  const itemWidth = items[0].offsetWidth + 32; // 包含左右padding
  
  function updateCarousel() {
    const offset = -currentIndex * itemWidth;
    track.style.transform = `translateX(${offset}px)`;
    
    // 更新指示器
    indicators.forEach((indicator, index) => {
      if (index === currentIndex) {
        indicator.classList.add('bg-primary', 'w-4');
        indicator.classList.remove('bg-muted');
      } else {
        indicator.classList.remove('bg-primary', 'w-4');
        indicator.classList.add('bg-muted');
      }
    });
  }
  
  function nextSlide() {
    currentIndex = (currentIndex + 1) % items.length;
    updateCarousel();
  }
  
  // 指示器点击事件
  indicators.forEach(indicator => {
    indicator.addEventListener('click', () => {
      currentIndex = parseInt(indicator.getAttribute('data-index') || '0');
      updateCarousel();
    });
  });
  
  // 自动轮播
  setInterval(nextSlide, 3000);
  
  // 窗口大小变化时重新计算
  window.addEventListener('resize', () => {
    updateCarousel();
  });
});
</script>

<style scoped>
.essay-carousel-container {
  position: relative;
  z-index: 20;
}

.carousel-btn {
  z-index: 10;
  cursor: pointer;
}

.carousel-indicators {
  z-index: 10;
}

.indicator {
  cursor: pointer;
}
</style>